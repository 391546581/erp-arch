# 架构自审清单 (Architecture Review Checklist)

> 每次修改架构设计时，对照以下清单进行自检。

---

## 战略层面 ✅

### 限界上下文
- [ ] 上下文的职责边界是否清晰？（"✅ 负责" 和 "❌ 不负责" 是否明确）
- [ ] 是否有业务逻辑跨越了上下文边界？
- [ ] 上下文之间是否只通过领域事件或共享契约通信？
- [ ] context-map.md 是否反映了最新的上下文关系？

### 域分类
- [ ] 核心域的确认是否基于业务竞争力分析？
- [ ] L1/L2/L3 的分级是否合理？（是否有过度设计或设计不足？）

---

## 战术层面 ✅

### 聚合设计
- [ ] 聚合是否足够小？（一个事务只修改一个聚合）
- [ ] 聚合间是否通过 ID 引用而非对象引用？
- [ ] 聚合根是否保护了所有不变量 (Invariants)？
- [ ] 是否有"贫血模型"伪装成"充血模型"（聚合根只有 getter/setter）？

### 状态机
- [ ] 状态转换是否覆盖了所有合法路径？
- [ ] 是否有遗漏的异常/错误状态？
- [ ] 非法状态转换是否会抛出明确的异常？

### 领域事件
- [ ] 事件的携带数据是否最小化？（不要放无关字段）
- [ ] 事件名是否使用过去式？（如 `PurchaseCompleted` 而非 `CompletePurchase`）
- [ ] 事件的消费者是否明确？
- [ ] 是否考虑了事件丢失/重复消费的情况？

### 值对象
- [ ] ID 是否封装为值对象？（如 `SnCode`, `SkuId`）
- [ ] 金额是否使用 `Money` 值对象？
- [ ] 值对象是否实现了 `equals()` 和 `hashCode()`？

---

## 业务流程层面 ✅

### SN 生命周期
- [ ] 所有状态转换是否在 sn-lifecycle.md 中有体现？
- [ ] 新增的业务流程是否更新了流程图？

### 成本归集
- [ ] 新增的成本来源是否在 cost-tracking.md 中有体现？
- [ ] 成本累加逻辑是否保持单调递增原则？

---

## 变更管理 ✅

- [ ] 变更是否记录在 CHANGELOG.md 中？
- [ ] 影响范围是否准确标注？
- [ ] 是否涉及 erp2-api 共享契约的破坏性变更？
- [ ] 相关文件间的一致性是否保持？（context-map ↔ tactical ↔ process）
